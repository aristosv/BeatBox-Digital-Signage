#!/bin/bash

temperaturemonitor () {
sudo bash -c 'cat > /etc/systemd/system/temperaturemonitor.service' << 'EOL'
[Unit]
Description=temperature monitor
After=network.target

[Service]
ExecStart=/bin/bash -c "while true; do if [ $(sudo /opt/vc/bin/vcgencmd measure_temp | sed -e 's/temp=//' | sed -e "s/[.].*//") -gt 1 ]; then { echo Subject: Temperature Alert - $HOSTNAME; echo Temperature on $HOSTNAME is $(sudo /opt/vc/bin/vcgencmd measure_temp | sed -e 's/temp=//' | sed -e "s/[.].*//"); } | ssmtp $emailaddress; fi; sleep 3600; done"
Restart=always

[Install]
WantedBy=multi-user.target
EOL
}

temperaturemonitor
